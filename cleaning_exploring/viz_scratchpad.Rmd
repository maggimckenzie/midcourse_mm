---
title: "viz_scratchpad"
author: "mmckenzie"
date: "1/17/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(plotly)
library(ggplot2)
library(stringr)
library(lubridate)
#library(hrbrthemes)
```

Raw game scores
```{r raw_scores}
game_scores <- read.csv('../data/j_scores.csv')
game_scores %>% head(20)
summary(game_scores)
```

FJ filtered scores
```{r fj_scores}
#select and filter
fj_win_scores <- game_scores %>% 
  select(round_code, show_num, contestant, score, finish) %>% 
  filter(finish == 'Winner', round_code == 'FJ')

fj_win_scores <- fj_win_scores %>% 
  mutate(bucket = score - (score %% 10000))
```

Raw game/clue data
```{r raw_game}
game_data <- read.csv('../data/j_clues.csv')
```

Filter for air_dates
```{r air_dates}
game_dates <- game_data %>% 
  select(season, show_num, air_date) %>% 
  count(season, show_num, air_date, name = 'clue_count')
  
```

Join the winners and air dates
```{r merge_airdates}
fj_win_scores <- fj_win_scores %>% 
  inner_join(game_dates, by = 'show_num')

fj_win_scores <- fj_win_scores %>% 
  mutate(air_year = format(as.Date(air_date, format = '%m/%d/%Y'),'%Y'))

fj_win_scores <-fj_win_scores %>% 
  mutate(bucket_name = as.character(bucket / 1000)) %>% 
  mutate(bucket_name = paste('$',bucket_name))

write.csv(fj_win_scores, '../data/fj_win_scores.csv', row.names=FALSE)

```


Plot the distribution of scores
```{r score_dist}
fj_win_scores %>% 
  select(show_num, season, air_year, contestant, bucket_name, score) %>% 
  ggplot(aes(y = air_year, x = score, color = bucket_name)) +
  geom_point()+
  scale_x_continuous(breaks=seq(0, 150000, 10000)) +
  theme(axis.text.x = element_text(angle= 90))

```


```{r}
fj_win_scores %>% 
  select(air_year, bucket_name) %>% 
  count(air_year, bucket_name, name = 'num_games') %>% 
  ggplot(aes(x = air_year, y = num_games, fill = bucket_name)) +
  geom_bar(position = "stack", stat="identity")+
  coord_flip()

  #scale_y_discrete()
  #theme(axis.text.x = element_text(angle= 90))
```

Category explorer
```{r category_exp}
#clues <- read.csv('../data/j_clues.csv')
distinct_cat <- clues %>% 
  distinct(show_num, air_date, round_code, category)

cat_occurs <- distinct_cat %>% 
  count(category, name = 'occurs') %>% 
  arrange(desc(occurs))

#fj_win_scores <- read.csv('../data/fj_win_scores.csv')

games <- fj_win_scores %>% 
  count()

cat_occurs <- cat_occurs %>% 
  mutate(pct_of_games = as.integer(occurs / 6293 * 10000)/100)
```

```{r save_cat_occurs}
#write.csv(cat_occurs, '../data/cat_occurs.csv', row.names=FALSE)
```

Attempt a circle graph, this will not be pretty
```{r circle_stuff}
library(packcircles)
library(viridis)
library(ggiraph)
```
```{r}
cat_occurs_gt1 <- cat_occurs %>% 
  filter(occurs >= 100) %>% 
  mutate(occurs_wt = occurs ** 3) %>% 
  arrange(category)

cat_occurs_gt1$text <- paste('Category: ',cat_occurs_gt1$category, '\n', 'Games Appearing: ',cat_occurs_gt1$occurs, '\n', 'Pct of Games: ', cat_occurs_gt1$pct_of_games)


packing <- circleProgressiveLayout(cat_occurs_gt1$occurs_wt, sizetype = 'area')
packing$radius <- 0.95 * packing$radius



cat_occurs_gt1 <- cbind(cat_occurs_gt1, packing)

cat.gg <- circleLayoutVertices(packing, npoints=50)

p<- ggplot()+
  geom_polygon_interactive(data = cat.gg, aes(x, y, group = id, fill = id, tooltip = cat_occurs_gt1$text[id], data_id = id),  alpha = 0.6)+
  scale_fill_viridis() +
  geom_text(data = cat_occurs_gt1, aes(x, y, label = category), size=2, color='black') + 
  theme_void()+
  theme(legend.position='none', plot.margin=unit(c(0,0,0,0),'cm'), panel.background = element_rect(fill = 'transparent', color = NA))+
  coord_equal()

widg <- ggiraph(ggobj = p, bg='transparent'#, width_svg = 10, height_svg = 10
                )
widg
# ggplot() +
#   geom_polygon(data = cat.gg, aes(x, y, group = id, fill=as.factor(id)), colour = "black", alpha = 0.6) +
#   geom_text(data = cat_occurs_gt1, aes(x, y, size=occurs_wt,label = category)) +
#   scale_size_continuous(range = c(1,4)) +
#   theme_void() +
#   theme(legend.position = 'none') + 
#   coord_equal()
```

Response explorer
```{r resp_exp}
distinct_resp <- clues %>% 
  distinct(show_num, air_date, round_code, corr_resp)

resp_occurs <- distinct_resp %>% 
  count(corr_resp, name = 'occurs') %>% 
  arrange(desc(occurs))

#fj_win_scores <- read.csv('../data/fj_win_scores.csv')

games <- fj_win_scores %>% 
  count()

resp_occurs <- resp_occurs %>% 
  mutate(pct_of_games = as.integer(occurs / 6293 * 10000)/100)

resp_occurs_gt1 <- resp_occurs %>% 
  filter(occurs >= 100) %>% 
  mutate(occurs_wt = occurs ** 3) %>% 
  arrange(corr_resp)

resp_occurs_gt1$text <- paste('Answer: ',resp_occurs_gt1$corr_resp, '\n', 'Games Appearing: ',resp_occurs_gt1$occurs, '\n', 'Pct of Games: ', resp_occurs_gt1$pct_of_games)

packing_r <- circleProgressiveLayout(resp_occurs_gt1$occurs_wt, sizetype = 'area')
packing_r$radius <- 0.95 * packing_r$radius

resp_occurs_gt1 <- cbind(resp_occurs_gt1, packing_r)

resp.gg <- circleLayoutVertices(packing_r, npoints=50)

p_r<- ggplot()+
  geom_polygon_interactive(data = resp.gg, aes(x, y, group = id, fill = id, tooltip = resp_occurs_gt1$text[id], data_id = id),  alpha = 0.6)+
  scale_fill_viridis() +
  geom_text(data = resp_occurs_gt1, aes(x, y, label = corr_resp), size=2, color='black') + 
  theme_void()+
  theme(legend.position='none', plot.margin=unit(c(0,0,0,0),'cm'), panel.background = element_rect(fill = 'transparent', color = NA))+
  coord_equal()

widg_r <- ggiraph(ggobj = p_r, bg='transparent'#, width_svg = 10, height_svg = 10
                )
widg_r
```

write resp_occurs
```{r}
#write.csv(resp_occurs, '../data/resp_occurs.csv', row.names=FALSE)
```

Select all the clue texts for a particular response
```{r clue_texts}
clues %>% 
  filter(corr_resp == 'Australia') %>% 
  select(category, clue_text)

```

interactive example for ggiraph
ui <- fluidPage(
    girafeOutput("plot1"),
    girafeOutput("plot2")
)
server <- function(input, output, session) {
output$plot1 <- renderGirafe({
        scatter <- ggplot(data,aes(x=displ,y=hwy)) +
            geom_point_interactive(aes(tooltip=model, data_id=model))
        x <- girafe(ggobj = scatter)
        x
    })
    observeEvent(input$plot1_selected,{
        output$plot2 <- renderGirafe({
        react <- ggplot(data[which(data$model==input$plot1_selected),],aes(x=cty)) +
              geom_bar()
        y <- girafe(ggobj = react)
        y
        })
    })
}


## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
